<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amaltools.com Teleprompter</title>
    {% load static %}
    <link href="{% static 'bootstrap-5.3.2-dist/css/bootstrap.min.css' %}" rel="stylesheet">
    <style>
        #teleprompter::-webkit-scrollbar {
            display: none;
        }

        #teleprompter {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
    </style>
</head>
<body class="d-flex flex-column vh-100 overflow-hidden">
    <div class="d-flex justify-content-between p-2 bg-light">
        <!-- play stop button -->
        <button id="play_pause" class="btn btn-primary">Play</button>

        <!-- speed control -->
        <div class="d-flex align-items-center">    
            <label for="speed" class="me-2">Speed:</label>
            <div class="input-group me-2">

                <input class="form-control" class="form-control" type="range" id="speed" name="speed" min="1" max="100" value="50">
                <span class="input-group-text" id="speed_value">50</span>
            </div>
        </div>

        <!-- fontsize control -->
        <div class="d-flex align-items-center">    
            <label for="font_size" class="me-2">Font size:</label>
            <input class="form-control" type="number" id="font_size" name="font_size" value="24" class="me-2">
            <span></span>
        </div>

        <!-- font family control -->
        <div class="d-flex align-items-center">
            <select name="font_family" id="font_family" class="form-select">
                <option>Font family</option>
                <!-- rest generated by javascript -->
            </select>
        </div>

        <!-- padding control -->
        <div class="d-flex align-items-center">
            <label for="padding" class="me-2">PaddingX:</label>
            <input class="form-control" type="range" id="padding_x" name="padding" value="20" max="100" class="me-2">
            <span></span>
        </div>

        <!-- font color -->
        <div class="d-flex align-items-center">
            <label for="font_color" class="me-2">Font Color</label>
            <input class="form-control form-control-color" type="color" name="font_color" id="font_color" value="#ffffff">
        </div>

        <!-- background color -->
        <div class="d-flex align-items-center">
            <label for="background_color" class="me-2">Background Color</label>
            <input class="form-control form-control-color" type="color" name="background_color" id="background_color">
        </div>
    </div>

    <!-- teleprompter display area -->
    <div id="teleprompter" contenteditable class="flex-grow-1 p-2 overflow-auto border-0" style="font-size: 24px; line-height: 1em;">
        <!-- The script will be displayed here -->
        <!-- hi my name is George I have come here to bargain, your alliance is quite disruptive to intergalactic trade and we have had to resort to less savoury methods to get our goods to our most affluent clienteleÂ   -->
    </div>
</body>
<script>
    var play_pause_button = document.getElementById("play_pause");
    var speed = document.getElementById("speed");
    var teleprompter = document.getElementById("teleprompter");
    var fontSize = document.getElementById("font_size");
    var fontFamily = document.getElementById("font_family");
    var fontColor = document.getElementById("font_color");
    var backgroundColor = document.getElementById("background_color");
    var paddingX = document.getElementById("padding_x");


    // Add event listeners to the input fields
    teleprompter.addEventListener("input", updateTeleprompter);
    speed.addEventListener("input", () => {
        updateTeleprompter()
        updateSpeedValue();
    });
    fontSize.addEventListener("input", updateTeleprompter);
    fontFamily.addEventListener("input", updateTeleprompter);
    fontColor.addEventListener("input", updateTeleprompter);
    backgroundColor.addEventListener("input", updateTeleprompter);
    paddingX.addEventListener("input", updateTeleprompter);

    play_pause_button.addEventListener('click',startScrolling)

    function updateTeleprompter() {
        // Update the preview div
        teleprompter.style.fontSize = fontSize.value + "px";
        teleprompter.style.fontFamily = fontFamily.value;
        teleprompter.style.color = fontColor.value;
        teleprompter.style.backgroundColor = backgroundColor.value;
        teleprompter.style.padding = "0 " + paddingX.value + "px";
    }

    function updateSpeedValue() {
        document.getElementById("speed_value").innerText = speed.value;
    }
    
    function updateFontSizeValue() {
        document.getElementById("font_size_value").innerText = fontSize.value;
    }

    // removes pasted text data
    teleprompter.addEventListener("paste", function(e) {
        e.preventDefault();
        var text = e.clipboardData.getData("text/plain");
        document.execCommand("insertHTML", false, text);
    });

    window.addEventListener('keydown', function(event) {
        if (event.key === '`') { // '`' is the character for the backtick key
            startScrolling();
            event.preventDefault(); // Prevent the default action
        }
    });

    var scrollInterval;
    var scrollAmount = 0;

    var isScrolling = false;

    function startScrolling() {
        if (isScrolling) {
            stopScrolling();
        } else {
            var scrollSpeed = 100 - speed.value;

            // Clear any existing interval
            if (scrollInterval) {
                clearInterval(scrollInterval);
            }

            function scrollContent() {
                if (scrollAmount < teleprompter.scrollHeight) {
                    teleprompter.scrollTop = scrollAmount;
                    scrollAmount += 1;
                } else {
                    scrollAmount = 0;
                    scrollContent(); // Immediately call the function again
                }
            }

            scrollInterval = setInterval(scrollContent, scrollSpeed);
            isScrolling = true;
        }
    }

    function stopScrolling() {
        if (scrollInterval) {
            clearInterval(scrollInterval);
        }
        isScrolling = false;
    }

    // Define the list of fonts
    var fonts = ["Arial", "Courier New", "Georgia", "Times New Roman", "Verdana", /* add more fonts here */];

    // Get the select element
    var select = document.getElementById("font_family");

    // Clear any existing options
    select.innerHTML = "";

    // Add an option for each font
    fonts.forEach(function(font) {
        var option = document.createElement("option");
        option.value = font;
        option.text = font;
        select.appendChild(option);
    });
    
</script>
<script src="{% static 'bootstrap-5.3.2-dist/js/bootstrap.min.js' %}"></script>
</html>